<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰²ã‚Šç®—ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', Meiryo, monospace;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .result.success {
            background-color: #f0fff0;
            border-left-color: #4CAF50;
        }
        .result.warning {
            background-color: #fff8e1;
            border-left-color: #ff9800;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(11, auto);
            gap: 2px;
            margin: 20px 0;
            font-size: 14px;
        }
        .cell {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            background: white;
        }
        .cell.header {
            background: #e0e0e0;
            font-weight: bold;
        }
        .cell.integer {
            background: #c8e6c9;
        }
        .cell.decimal {
            background: #ffccbc;
        }
        .stats {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        .stats div {
            margin: 8px 0;
            font-size: 16px;
        }
        .stats strong {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§® å‰²ã‚Šç®—ãƒ—ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ãƒ†ã‚¹ãƒˆè¨­å®š</h2>
        <p>ã‚°ãƒªãƒƒãƒ‰ã‚µã‚¤ã‚º: <strong>10Ã—10</strong></p>
        <p>ç›®æ¨™æ•´æ•°è§£å‰²åˆ: 
            <select id="ratioSelect">
                <option value="60">60%</option>
                <option value="70" selected>70%</option>
                <option value="80">80%</option>
            </select>
        </p>
        <p>ãƒ—ãƒªã‚»ãƒƒãƒˆ: 
            <select id="presetSelect">
                <option value="easy">ç°¡å˜ï¼ˆ2æ¡Ã·1æ¡ï¼‰</option>
                <option value="normal" selected>æ™®é€šï¼ˆ3æ¡Ã·1æ¡ï¼‰</option>
                <option value="hard">é›£ã—ã„ï¼ˆ3æ¡Ã·2æ¡ï¼‰</option>
            </select>
        </p>
        <p style="color: #666; font-size: 14px;">
            â€» 10åˆ—ã®å ´åˆã€é™¤æ•°ã¯1ï½10ï¼ˆé‡è¤‡ãªã—ï¼‰
        </p>
        <button onclick="runTest()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="runMultipleTests()">10å›ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div id="results"></div>
    
    <script src="js/translations.js"></script>
    <script>
        // å¿…è¦ãªé–¢æ•°ã‚’ã‚³ãƒ”ãƒ¼
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function generateDivisiblePair(dividendMin, dividendMax, divisorMin, divisorMax) {
            let divisor;
            if (divisorMin <= 0 && divisorMax >= 0) {
                const validDivisors = [];
                for (let i = divisorMin; i <= divisorMax; i++) {
                    if (i !== 0) validDivisors.push(i);
                }
                divisor = validDivisors[Math.floor(Math.random() * validDivisors.length)];
            } else {
                divisor = Math.floor(Math.random() * (divisorMax - divisorMin + 1)) + divisorMin;
            }
            
            const minMultiplier = Math.ceil(dividendMin / divisor);
            const maxMultiplier = Math.floor(dividendMax / divisor);
            
            if (minMultiplier > maxMultiplier) {
                const dividend = Math.floor((dividendMin + dividendMax) / 2);
                return { dividend, divisor };
            }
            
            const multiplier = Math.floor(Math.random() * (maxMultiplier - minMultiplier + 1)) + minMultiplier;
            const dividend = divisor * multiplier;
            
            return { dividend, divisor };
        }
        
        function generateDivisionNumbersWithRatio(dividendMin, dividendMax, divisorMin, divisorMax, rowSize, colSize, integerRatio) {
            const totalCells = rowSize * colSize;
            const targetIntegerCount = Math.round(totalCells * integerRatio / 100);
            
            let bestRowNumbers = null;
            let bestColNumbers = null;
            let bestScore = 0;
            
            const maxAttempts = 50;
            
            for (let attempt = 0; attempt < maxAttempts; attempt++) {
                const rowNumbers = [];
                const colNumbers = [];
                
                const divisorPool = [];
                for (let i = 0; i < Math.ceil(colSize * 0.7); i++) {
                    let divisor;
                    if (divisorMin <= 0 && divisorMax >= 0) {
                        const validDivisors = [];
                        for (let j = divisorMin; j <= divisorMax; j++) {
                            if (j !== 0) validDivisors.push(j);
                        }
                        divisor = validDivisors[Math.floor(Math.random() * validDivisors.length)];
                    } else {
                        divisor = Math.floor(Math.random() * (divisorMax - divisorMin + 1)) + divisorMin;
                    }
                    divisorPool.push(divisor);
                }
                
                for (let i = divisorPool.length; i < colSize; i++) {
                    let divisor;
                    if (divisorMin <= 0 && divisorMax >= 0) {
                        const validDivisors = [];
                        for (let j = divisorMin; j <= divisorMax; j++) {
                            if (j !== 0) validDivisors.push(j);
                        }
                        divisor = validDivisors[Math.floor(Math.random() * validDivisors.length)];
                    } else {
                        divisor = Math.floor(Math.random() * (divisorMax - divisorMin + 1)) + divisorMin;
                    }
                    divisorPool.push(divisor);
                }
                
                colNumbers.push(...shuffleArray(divisorPool).slice(0, colSize));
                
                for (let i = 0; i < rowSize; i++) {
                    if (i < rowSize * 0.7) {
                        const baseDivisor = divisorPool[Math.floor(Math.random() * divisorPool.length)];
                        const minMult = Math.ceil(dividendMin / Math.abs(baseDivisor));
                        const maxMult = Math.floor(dividendMax / Math.abs(baseDivisor));
                        
                        if (minMult <= maxMult) {
                            const multiplier = Math.floor(Math.random() * (maxMult - minMult + 1)) + minMult;
                            rowNumbers.push(baseDivisor * multiplier);
                        } else {
                            rowNumbers.push(Math.floor(Math.random() * (dividendMax - dividendMin + 1)) + dividendMin);
                        }
                    } else {
                        rowNumbers.push(Math.floor(Math.random() * (dividendMax - dividendMin + 1)) + dividendMin);
                    }
                }
                
                let integerCount = 0;
                for (let i = 0; i < rowSize; i++) {
                    for (let j = 0; j < colSize; j++) {
                        if (rowNumbers[i] % colNumbers[j] === 0) {
                            integerCount++;
                        }
                    }
                }
                
                const score = 1000 - Math.abs(integerCount - targetIntegerCount);
                
                if (score > bestScore) {
                    bestScore = score;
                    bestRowNumbers = [...rowNumbers];
                    bestColNumbers = [...colNumbers];
                }
                
                if (integerCount === targetIntegerCount) {
                    break;
                }
            }
            
            return {
                rowNumbers: bestRowNumbers,
                colNumbers: bestColNumbers
            };
        }
        
        function getPresetRanges(preset) {
            switch(preset) {
                case 'easy':
                    return { dividendMin: 10, dividendMax: 99, divisorMin: 1, divisorMax: 10 };
                case 'normal':
                    return { dividendMin: 100, dividendMax: 999, divisorMin: 1, divisorMax: 10 };
                case 'hard':
                    return { dividendMin: 100, dividendMax: 999, divisorMin: 10, divisorMax: 99 };
                default:
                    return { dividendMin: 21, dividendMax: 30, divisorMin: 1, divisorMax: 10 };
            }
        }
        
        function runTest() {
            const ratio = parseInt(document.getElementById('ratioSelect').value);
            const preset = document.getElementById('presetSelect').value;
            const ranges = getPresetRanges(preset);
            const rowSize = 10;
            const colSize = 10;
            const totalCells = rowSize * colSize;
            const targetCount = Math.round(totalCells * ratio / 100);
            
            const result = generateDivisionNumbersWithRatio(
                ranges.dividendMin, ranges.dividendMax,
                ranges.divisorMin, ranges.divisorMax,
                rowSize, colSize, ratio
            );
            
            // æ•´æ•°è§£ã®å€‹æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            let integerCount = 0;
            const grid = [];
            
            for (let i = 0; i < rowSize; i++) {
                const row = [];
                for (let j = 0; j < colSize; j++) {
                    const dividend = result.rowNumbers[i];
                    const divisor = result.colNumbers[j];
                    const quotient = dividend / divisor;
                    const isInteger = Number.isInteger(quotient);
                    
                    if (isInteger) integerCount++;
                    
                    row.push({
                        dividend,
                        divisor,
                        quotient,
                        isInteger
                    });
                }
                grid.push(row);
            }
            
            const actualRatio = (integerCount / totalCells * 100).toFixed(1);
            const isSuccess = Math.abs(integerCount - targetCount) <= 5;
            
            displayResult({
                ratio,
                preset,
                targetCount,
                integerCount,
                actualRatio,
                isSuccess,
                rowNumbers: result.rowNumbers,
                colNumbers: result.colNumbers,
                grid
            }, false);
        }
        
        function runMultipleTests() {
            const ratio = parseInt(document.getElementById('ratioSelect').value);
            const preset = document.getElementById('presetSelect').value;
            const ranges = getPresetRanges(preset);
            const rowSize = 10;
            const colSize = 10;
            const totalCells = rowSize * colSize;
            const targetCount = Math.round(totalCells * ratio / 100);
            
            let results = [];
            let successCount = 0;
            
            for (let test = 0; test < 10; test++) {
                const result = generateDivisionNumbersWithRatio(
                    ranges.dividendMin, ranges.dividendMax,
                    ranges.divisorMin, ranges.divisorMax,
                    rowSize, colSize, ratio
                );
                
                let integerCount = 0;
                for (let i = 0; i < rowSize; i++) {
                    for (let j = 0; j < colSize; j++) {
                        if (result.rowNumbers[i] % result.colNumbers[j] === 0) {
                            integerCount++;
                        }
                    }
                }
                
                results.push(integerCount);
                if (Math.abs(integerCount - targetCount) <= 5) successCount++;
            }
            
            const avgInteger = results.reduce((a, b) => a + b, 0) / 10;
            const minInteger = Math.min(...results);
            const maxInteger = Math.max(...results);
            
            displayMultipleResults({
                ratio,
                preset,
                targetCount,
                results,
                avgInteger,
                minInteger,
                maxInteger,
                successCount
            });
        }
        
        function displayResult(data, isMultiple) {
            const resultsDiv = document.getElementById('results');
            const resultClass = data.isSuccess ? 'success' : 'warning';
            
            let html = `
                <div class="test-container">
                    <h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>
                    <div class="stats">
                        <div><strong>ãƒ—ãƒªã‚»ãƒƒãƒˆ:</strong> ${data.preset}</div>
                        <div><strong>ç›®æ¨™å‰²åˆ:</strong> ${data.ratio}% (${data.targetCount}ã‚»ãƒ«)</div>
                        <div><strong>å®Ÿéš›ã®æ•´æ•°è§£:</strong> ${data.integerCount}ã‚»ãƒ«</div>
                        <div><strong>å®Ÿéš›ã®å‰²åˆ:</strong> ${data.actualRatio}%</div>
                        <div><strong>åˆ¤å®š:</strong> ${data.isSuccess ? 'âœ… æˆåŠŸï¼ˆÂ±5ã‚»ãƒ«ä»¥å†…ï¼‰' : 'âš ï¸ ç›®æ¨™ã‹ã‚‰é›¢ã‚Œã¦ã„ã‚‹'}</div>
                    </div>
                    
                    <h3>ç”Ÿæˆã•ã‚ŒãŸã‚°ãƒªãƒƒãƒ‰</h3>
                    <div class="grid">
                        <div class="cell header">Ã·</div>
                        ${data.colNumbers.map(n => `<div class="cell header">${n}</div>`).join('')}
                        ${data.rowNumbers.map((rowNum, i) => `
                            <div class="cell header">${rowNum}</div>
                            ${data.colNumbers.map((colNum, j) => {
                                const cell = data.grid[i][j];
                                const className = cell.isInteger ? 'integer' : 'decimal';
                                return `<div class="cell ${className}">${cell.quotient.toFixed(2)}</div>`;
                            }).join('')}
                        `).join('')}
                    </div>
                    
                    <p><strong>å‡¡ä¾‹:</strong> <span style="background:#c8e6c9; padding:4px 8px;">ç·‘=æ•´æ•°è§£</span> <span style="background:#ffccbc; padding:4px 8px; margin-left:10px;">æ©™=å°æ•°è§£</span></p>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        function displayMultipleResults(data) {
            const resultsDiv = document.getElementById('results');
            
            let html = `
                <div class="test-container">
                    <h2>10å›ãƒ†ã‚¹ãƒˆçµæœï¼ˆé›†è¨ˆï¼‰</h2>
                    <div class="stats">
                        <div><strong>ãƒ—ãƒªã‚»ãƒƒãƒˆ:</strong> ${data.preset}</div>
                        <div><strong>ç›®æ¨™å‰²åˆ:</strong> ${data.ratio}% (${data.targetCount}ã‚»ãƒ«)</div>
                        <div><strong>å¹³å‡æ•´æ•°è§£:</strong> ${data.avgInteger.toFixed(1)}ã‚»ãƒ«</div>
                        <div><strong>æœ€å°æ•´æ•°è§£:</strong> ${data.minInteger}ã‚»ãƒ«</div>
                        <div><strong>æœ€å¤§æ•´æ•°è§£:</strong> ${data.maxInteger}ã‚»ãƒ«</div>
                        <div><strong>æˆåŠŸç‡:</strong> ${data.successCount}/10å› (${data.successCount * 10}%)</div>
                    </div>
                    
                    <h3>å„ãƒ†ã‚¹ãƒˆã®çµæœ</h3>
                    <div style="padding: 15px; background: #f5f5f5; border-radius: 6px;">
                        ${data.results.map((count, i) => {
                            const diff = count - data.targetCount;
                            const symbol = diff === 0 ? 'ğŸ¯' : Math.abs(diff) <= 5 ? 'âœ…' : 'âš ï¸';
                            return `<div>ãƒ†ã‚¹ãƒˆ${i+1}: ${count}ã‚»ãƒ« (${symbol} ${diff >= 0 ? '+' : ''}${diff})</div>`;
                        }).join('')}
                    </div>
                    
                    <p style="margin-top: 20px; font-size: 14px; color: #666;">
                        <strong>åˆ¤å®šåŸºæº–:</strong> ç›®æ¨™Â±5ã‚»ãƒ«ä»¥å†…ãªã‚‰æˆåŠŸ<br>
                        ğŸ¯ = ã´ã£ãŸã‚Š / âœ… = æˆåŠŸ / âš ï¸ = ç›®æ¨™ã‹ã‚‰é›¢ã‚Œã¦ã„ã‚‹
                    </p>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«1å›ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(runTest, 500);
        });
    </script>
</body>
</html>
