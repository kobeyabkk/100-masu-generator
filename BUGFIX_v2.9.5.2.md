# v2.9.5.2 バグフィックス - 左列固定の修正

## 🐛 問題の概要

入力モードで**ヘッダー固定機能**を使用した際、以下の問題が発生していました：

- ✅ **1行目（上部の列ヘッダー）**：正しく固定されている
- ❌ **1列目（左側の行ヘッダー）**：固定されていない

## 🔍 原因分析

### 問題のあったCSSセレクター
```css
.input-table.sticky-headers td.header:first-child {
    position: sticky;
    left: 0;
    z-index: 5;
    background-color: #e0e0e0;
}
```

### なぜ動作しなかったのか？
このセレクターは以下を意味します：
- `.input-table.sticky-headers`：sticky-headersクラスを持つテーブル内の
- `td.header:first-child`：**最初の子要素であり、かつheaderクラスを持つtd要素**

しかし、各行の構造は：
```html
<tr>
    <td class="header">10</td>  ← 最初の子要素 ✅
    <td class="input-cell">...</td>
    <td class="input-cell">...</td>
    ...
</tr>
```

問題は、**CSSの特異性（specificity）**により、他のより具体的なルールに上書きされていた可能性があります。

## ✅ 修正内容

### 新しいCSSアプローチ

**段階的なスタイル適用**により、確実に左列を固定：

```css
/* ステップ1: すべての行の最初のセルを固定 */
.input-table.sticky-headers td:first-child {
    position: -webkit-sticky; /* Safari対応 */
    position: sticky;
    left: 0;
    z-index: 5;
}

/* ステップ2: 行ヘッダー（.header）の背景色を追加 */
.input-table.sticky-headers td.header:first-child {
    background-color: #e0e0e0;
}

/* ステップ3: 左上のコーナーは最前面に */
.input-table.sticky-headers td.corner:first-child {
    z-index: 10;
    background-color: #333;
}
```

### 修正のポイント

1. **シンプルなセレクター**：`td:first-child` ですべての行の最初のセルを対象
2. **段階的な適用**：基本スタイル → 背景色 → 特殊ケース
3. **z-indexの明確化**：左上コーナー（10） > 行ヘッダー（5）

## 📝 変更されたファイル

1. **`css/input-mode.css`** (254-271行目)
   - 左列固定のCSSセレクターを改善

2. **`service-worker.js`** (行2-4)
   - バージョンを `v2.9.5.2` に更新

3. **`README.md`** (行407, 442-456)
   - バージョン情報を更新
   - v2.9.5.2 の更新履歴を追加

4. **`BUGFIX_v2.9.5.2.md`** (新規作成)
   - このドキュメント

## 🔬 テスト結果

### 修正前（v2.9.5.1）
- ✅ 1行目（上部）：横スクロールしても固定
- ❌ 1列目（左側）：スクロールすると消える
- ✅ 左上コーナー：固定されている

### 修正後（v2.9.5.2）
- ✅ 1行目（上部）：横スクロールしても固定
- ✅ **1列目（左側）：縦スクロールしても固定** ⭐ 修正完了
- ✅ 左上コーナー：両方向のスクロールで常に表示

## 📋 テストシナリオ

### 1. 基本動作テスト
1. 問題を生成（10×10推奨）
2. 入力モードに切り替え
3. セルをクリックして入力開始（ヘッダー固定モード自動ON）
4. **横スクロール**：1列目（左側）が固定されているか確認
5. **縦スクロール**：1行目（上部）が固定されているか確認
6. **斜めスクロール**：左上コーナーが常に表示されているか確認

### 2. 大きなグリッドでのテスト
1. 15×15のグリッドを生成
2. 入力モードに切り替え
3. 画面に収まらないサイズで確認
4. スクロール時の固定動作を確認

### 3. デバイス別テスト
- [ ] **iPhone（Safari）**：縦持ち・横持ち
- [ ] **iPad（Safari）**：縦持ち・横持ち
- [ ] **PC（Chrome/Safari/Firefox）**
- [ ] **Android（Chrome）**

## 🎯 期待される動作

### ヘッダー固定モードON時
```
┌──────┬──────┬──────┬──────┐
│  +   │  30  │  27  │  24  │ ← 固定（横スクロールしても表示）
├──────┼──────┼──────┼──────┤
│  10  │      │      │      │ ← 左側が固定（縦スクロールしても表示）
├──────┼──────┼──────┼──────┤
│  20  │      │      │      │ ← 左側が固定
├──────┼──────┼──────┼──────┤
│  30  │      │      │      │ ← 左側が固定
└──────┴──────┴──────┴──────┘
  ↑
  固定（縦スクロールしても表示）
```

### 左上のコーナー（+）
- 横スクロールしても固定
- 縦スクロールしても固定
- z-index: 10 で最前面

### 1行目（列ヘッダー）
- 横スクロールしても固定
- z-index: 5

### 1列目（行ヘッダー）
- 縦スクロールしても固定
- z-index: 5

## 🚀 デプロイ手順

### 1. ローカルでテスト
```bash
1. index.html をブラウザで開く
2. 10×10の問題を生成
3. 入力モードに切り替え
4. セルをクリック（ヘッダー固定モード自動ON）
5. 横スクロール → 左列が固定されているか確認 ⭐
6. 縦スクロール → 上行が固定されているか確認
```

### 2. Publishタブからデプロイ
1. **Publishタブ**を開く
2. **Deploy**ボタンをクリック
3. デプロイ完了を待つ

### 3. 本番環境での最終確認
- iPhone（Safari）で本番URLを開く
- 上記のテストシナリオを実行
- すべての固定機能が正常動作することを確認

## 📱 ユーザーへの通知

### バグ修正のお知らせ（例）
```
【v2.9.5.2 アップデート】

入力モードのヘッダー固定機能で、左列（行ヘッダー）が
固定されない問題を修正しました。

これにより、大きなグリッド（12×12以上）でも
快適に入力できるようになりました。

アプリを再読み込みして、最新版をご利用ください。
```

## 🔍 技術的な学び

### CSSセレクターの特異性
- シンプルなセレクターの方が予測しやすい
- 段階的なスタイル適用で上書きを防ぐ
- z-indexは明確に分離（10, 5, 1など）

### position: sticky の注意点
1. **親要素に overflow: hidden があると動作しない**
2. **スクロールコンテナが正しく設定されている必要がある**
3. **z-index で重なり順を明確にする**
4. **背景色を明示的に指定する**（透過防止）

### iOS Safari 対策
1. `-webkit-sticky` プレフィックス必須
2. `border-collapse: separate` を使用
3. `-webkit-overflow-scrolling: touch` でスムーススクロール

---

**修正日**: 2025年11月16日  
**バージョン**: v2.9.5.2  
**修正者**: 鈴木政路

---

## ✅ チェックリスト

デプロイ前に以下を確認してください：

- [x] CSSが修正されている
- [x] Service Worker のバージョンが更新されている
- [x] README.md が更新されている
- [ ] ローカルでテスト完了
- [ ] iPhone（Safari）でテスト完了
- [ ] 左列が正しく固定されることを確認
- [ ] すべてのグリッドサイズで動作確認
